# ุฏูุฌ ูุธุงู ุงูุฏุนู ุงูููู ูู ุงููุญุงุฏุซุงุช - ุงูุชูู โ

## ุงูุชุนุฏููุงุช ุงููููุฐุฉ

### 1. ุชุนุฏูู API ุงููุญุงุฏุซุงุช (`/api/conversations/route.ts`)
โ **ุฏูุฌ ุชุฐุงูุฑ ุงูุฏุนู ูุน ุงููุญุงุฏุซุงุช ุงูุนุงุฏูุฉ:**
- ุนูุฏ ุงุณุชุนูุงู ุงููุณุชุฎุฏู ุนู ูุญุงุฏุซุงุชูุ ูุชู ุฌูุจ ุงููุญุงุฏุซุงุช ุงูุนุงุฏูุฉ ูุงูุชุฐุงูุฑ ูุนุงู
- ุชุญููู ุงูุชุฐุงูุฑ ูุชุจุฏู ููุญุงุฏุซุงุช ุนุงุฏูุฉ ูุน ููุน `type: 'support'`
- ุญุณุงุจ ุนุฏุฏ ุงูุฑุณุงุฆู ุบูุฑ ุงูููุฑูุกุฉ ููู ุชุฐูุฑุฉ
- ุชุฑุชูุจ ุฌููุน ุงููุญุงุฏุซุงุช ุญุณุจ ุขุฎุฑ ูุดุงุท
- ุงุณุชุฎุฏุงู `supportTicketId` ูุชูููุฒ ุงูุชุฐุงูุฑ

**ูุซุงู ุนูู ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ:**
```json
{
  "conversations": [
    {
      "id": "support-5",
      "type": "support",
      "supportTicketId": 5,
      "subject": "ูุดููุฉ ูู ุงูุฏูุน",
      "status": "open",
      "lastBody": "ูุฑุฌู ุงููุณุงุนุฏุฉ...",
      "lastAt": "2025-10-28T10:30:00",
      "unreadCount": 2
    },
    {
      "id": 123,
      "type": "conversation",
      "userId": 10,
      "companyId": 5,
      "lastBody": "ุดูุฑุงู ูู",
      "lastAt": "2025-10-28T09:15:00",
      "unreadCount": 0
    }
  ]
}
```

---

### 2. ุชุนุฏูู API ุงูุฑุณุงุฆู (`/api/messages/route.ts`)

#### **POST - ุฅุฑุณุงู ุฑุณุงูุฉ:**
โ **ุฏุนู ููุนูู ูู ุงูุฑุณุงุฆู:**
- **ุฑุณุงุฆู ุนุงุฏูุฉ:** `{ userId, companyId, senderType, senderId, text }`
- **ุฑุณุงุฆู ุงูุฏุนู:** `{ supportTicketId, senderType, senderId, text }`

โ **ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ:**
- ุนูุฏ ุฑุฏ Admin ุนูู ุชุฐูุฑุฉุ ููุฑุณู ุฅุดุนุงุฑ ูููุณุชุฎุฏู
- ุนูุฏ ุฅุฑุณุงู ุงููุณุชุฎุฏู ุฑุณุงูุฉุ ููุญุฏูุซ timestamp ุงูุชุฐูุฑุฉ
- ุงูุฅุดุนุงุฑ ูุญุชูู ุนูู ุฑุงุจุท `/messages` (ููุญุฏ ูููู)

#### **GET - ุฌูุจ ุงูุฑุณุงุฆู:**
โ **ุฏุนู ูุนุงูููู:**
- `?conversationId=123` โ ุฑุณุงุฆู ูุญุงุฏุซุฉ ุนุงุฏูุฉ
- `?supportTicketId=5` โ ุฑุณุงุฆู ุชุฐูุฑุฉ ุฏุนู (ูุญูููุฉ ููุตูุบุฉ ุงูููุญุฏุฉ)

---

### 3. ุชุนุฏูู API ุนูุงูุฉ ุงููุฑุงุกุฉ (`/api/messages/read/route.ts`)
โ **ุฏุนู ุงูููุนูู:**
- ุงููุญุงุฏุซุงุช ุงูุนุงุฏูุฉ: `{ conversationId, userType }`
- ุชุฐุงูุฑ ุงูุฏุนู: `{ supportTicketId, userId }`
- ุชุญุฏูุซ `lastReadAt` ููุชุฐูุฑุฉ โ ุฅุนุงุฏุฉ ุญุณุงุจ `unreadCount`

---

### 4. ุชุญุฏูุซ ุตูุญุฉ ุงููุญุงุฏุซุงุช (`/app/messages/page.tsx`)

#### **TypeScript Types:**
```typescript
type Conversation = { 
  id: number | string; 
  type?: 'conversation' | 'support';
  supportTicketId?: number;
  subject?: string;
  status?: string;
  // ... other fields
};
```

#### **ุฌูุจ ุงููุญุงุฏุซุงุช:**
โ ุงูุชุฐุงูุฑ ุชูุนุฑุถ ูุน ุงุณู "ุฏุนู ููู #ุฑูู"
โ ุฃููููุฉ ๐๏ธ ููุชุฐุงูุฑ
โ ุจุฏุฌุงุช ุงูุญุงูุฉ (๐ก ููุชูุญุฉุ ๐ข ุชู ุงูุฑุฏุ โซ ูุบููุฉ)

#### **ุนุฑุถ ุงูุฑุณุงุฆู:**
โ ุชูููุฒ ุฑุณุงุฆู Admin ุจููู ุจููุณุฌู-ูุฑุฏู
โ ุนุฑุถ "๐๏ธ ุงูุฏุนู ุงูููู" ููู ุฑุณุงุฆู Admin
โ ุฑุณุงุฆู ุงููุณุชุฎุฏู ุจููู ุฃุฒุฑู-ุณูุงูู

#### **ุฅุฑุณุงู ุงูุฑุณุงุฆู:**
โ ุงูุชุนุงูู ุงูููุญุฏ ูุน ุงูููุนูู
โ ุฅุนุงุฏุฉ ุชุญููู ุงูุฑุณุงุฆู ุจุนุฏ ุงูุฅุฑุณุงู
โ ุฅุฎูุงุก ุญูู ุงูุฅุฏุฎุงู ููุชุฐุงูุฑ ุงููุบููุฉ

#### **ุงููุงุฌูุฉ:**
โ ุฅุฎูุงุก ุฃุฒุฑุงุฑ "ุฅุชูุงู/ุฅูุบุงุก ุงูุชุนุงูุฏ" ูู ูุญุงุฏุซุงุช ุงูุฏุนู
โ ุนุฑุถ ุจุฏุฌุฉ ุงูุญุงูุฉ ุจุฏูุงู ูู ุงูุฃุฒุฑุงุฑ
โ ุญุฏ ุจููุณุฌู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ููุชุฐุงูุฑ

---

### 5. ุชุญุฏูุซ ุงูู Header (`/components/layout/Header.tsx`)
โ **ุชูุฌูู ููุญุฏ:**
- ุฌููุน ุงููุญุงุฏุซุงุช (ุนุงุฏูุฉ + ุฏุนู) ุชูุชุญ `/messages`
- ุฅุฒุงูุฉ ุงูุชูุฌูู ุงููููุตู `/support-chat/[id]`
- ุญุฏ ุจููุณุฌู ููุชุฐุงูุฑ ูู dropdown

---

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1๏ธโฃ **ุชุฌุฑุจุฉ ููุญุฏุฉ:**
- ุงููุณุชุฎุฏู ูุฑู ุฌููุน ูุญุงุฏุซุงุชู ูู ููุงู ูุงุญุฏ
- ูุง ุญุงุฌุฉ ููุชููู ุจูู ุตูุญุงุช ูุฎุชููุฉ
- ุงูุชุฐุงูุฑ ุชุจุฏู ููุญุงุฏุซุงุช ุนุงุฏูุฉ ุจุชูููุฒ ุจุตุฑู

### 2๏ธโฃ **ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ:**
- ุนูุฏ ุฑุฏ ุงูุฏุนู ุงูููู ุนูู ุชุฐูุฑุฉ โ ุฅุดุนุงุฑ ูููุณุชุฎุฏู
- ุงูุฅุดุนุงุฑ ููุชุญ `/messages` ูุจุงุดุฑุฉ
- ููุณ ุขููุฉ ุงูุฅุดุนุงุฑุงุช ูููุญุงุฏุซุงุช ุงูุนุงุฏูุฉ

### 3๏ธโฃ **ุชูููุฒ ุจุตุฑู ูุงุถุญ:**
- ๐๏ธ ุฃููููุฉ ุงูุฏุนู
- ููู ุจููุณุฌู-ูุฑุฏู ููุชุฐุงูุฑ
- ุจุฏุฌุงุช ุงูุญุงูุฉ (๐ก๐ขโซ)
- ุญุฏ ุจููุณุฌู ูู ุงูููุงุฆู

### 4๏ธโฃ **ุญูุงูุฉ ุงููุญุชูู:**
- ุฅุฎูุงุก ุญูู ุงูุฅุฏุฎุงู ููุชุฐุงูุฑ ุงููุบููุฉ
- ุฅุฎูุงุก ุฃุฒุฑุงุฑ ุงูุชุนุงูุฏ ูู ูุญุงุฏุซุงุช ุงูุฏุนู
- ุนุฑุถ ุฑูู ุงูุชุฐูุฑุฉ ุจูุถูุญ

---

## ูุณุงุฑ ุงููุณุชุฎุฏู ุงููุงูู

### ุฅูุดุงุก ุชุฐูุฑุฉ ุฏุนู:
1. ุงููุณุชุฎุฏู ูููุฃ ูููุฐุฌ "ุงุชุตู ุจูุง"
2. ูููุดุฃ ุชุฐูุฑุฉ ูู `support_tickets`
3. **ุชุธูุฑ ุงูุชุฐูุฑุฉ ููุฑุงู ูู `/messages` ููุญุงุฏุซุฉ ๐๏ธ**

### ุนูุฏ ุฑุฏ ุงูุฏุนู ุงูููู:
1. Admin ูุฑุฏ ูู ููุญุฉ ุงูุชุญูู
2. ููุฑุณู ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุชููุงุฆูุงู
3. **ุงููุณุชุฎุฏู ููุชุญ ุงูุฅุดุนุงุฑ โ ูููุฌูู ูู `/messages`**
4. ูุฑู ุงูุฑุฏ ูู ูุญุงุฏุซุฉ ุงูุฏุนู

### ุนูุฏ ุฑุฏ ุงููุณุชุฎุฏู:
1. ุงููุณุชุฎุฏู ููุชุจ ุฑุฏ ูู `/messages`
2. ููุญุฏูุซ timestamp ุงูุชุฐูุฑุฉ
3. **ุชุฑุชูุน ุงูุชุฐูุฑุฉ ูุฃุนูู ุงููุงุฆูุฉ**

---

## ุงููุฑููุงุช ุนู ุงููุธุงู ุงูุณุงุจู

| **ูุจู** | **ุจุนุฏ** |
|---------|---------|
| ุตูุญุฉ ูููุตูุฉ `/support-chat/[id]` | ูู ุดูุก ูู `/messages` |
| dropdown ูููุตู ููุชุฐุงูุฑ | dropdown ููุญุฏ |
| ุฅุดุนุงุฑุงุช ูููุตูุฉ | ุฅุดุนุงุฑุงุช ููุญุฏุฉ |
| ุชูุฌูู ูุฎุชูู ููุชุฐุงูุฑ | ุชูุฌูู ููุญุฏ ูููู |
| ููุฏ ููุฑุฑ ูู Header | ููุฏ ููุจุณูุท |

---

## ูููุงุช ุชู ุชุนุฏูููุง

1. โ `/app/api/conversations/route.ts`
2. โ `/app/api/messages/route.ts`
3. โ `/app/api/messages/read/route.ts`
4. โ `/app/messages/page.tsx`
5. โ `/components/layout/Header.tsx`

---

## ุงุฎุชุจุงุฑ ุงููุธุงู

### โ ูุฌุจ ุฃู ุชุนูู ุงูุขู:
- [x] ูุชุญ `/messages` โ ุฑุคูุฉ ุฌููุน ุงููุญุงุฏุซุงุช (ุนุงุฏูุฉ + ุฏุนู)
- [x] ุงูููุฑ ุนูู ุชุฐูุฑุฉ ุฏุนู โ ูุชุญูุง ูู ููุณ ุงูุตูุญุฉ
- [x] ุงูุฑุฏ ุนูู ุชุฐูุฑุฉ โ ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู
- [x] ุฑุคูุฉ ุฑุณุงุฆู Admin ุจููู ุจููุณุฌู ูุน ุนูุงูุฉ ๐๏ธ
- [x] ุจุฏุฌุงุช ุงูุญุงูุฉ ุชุธูุฑ ุจูุถูุญ
- [x] ุงูุชุฐุงูุฑ ุงููุบููุฉ ูุง ุชูุจู ุฑุณุงุฆู ุฌุฏูุฏุฉ
- [x] ุนุฏุงุฏ ุงูุฑุณุงุฆู ุบูุฑ ุงูููุฑูุกุฉ ูุนูู ููููุนูู
- [x] Header dropdown ูุนุฑุถ ุงูุชุฐุงูุฑ ูุน ุญุฏ ุจููุณุฌู

---

## ููุงุญุธุงุช ูููุฉ

โ๏ธ **ุตูุญุฉ `/support-chat/[id]` ูุง ุฒุงูุช ููุฌูุฏุฉ** ููู ูุง ุชูุณุชุฎุฏู ุจุนุฏ ุงูุขู (ูููู ุญุฐููุง ูุงุญูุงู)

โ **ุฌููุน ุงูุฅุดุนุงุฑุงุช ุชูุชุญ `/messages` ุงูุขู** - ูุง ุญุงุฌุฉ ููุนุงูุฌุฉ ุฑูุงุจุท ูููุตูุฉ

โ **ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุชุชุบูุฑ** - ููุท ุทุฑููุฉ ุงุณุชุนูุงู ูุนุฑุถ ุงูุจูุงูุงุช

โ **ุงูู API ุงูุฎุงุต ุจุงูุฏุนู `/api/support` ูุง ุฒุงู ูุนูู** ูููุญุฉ ุงูุชุญูู ููุท

---

## ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

๐ **ูุธุงู ููุญุฏ ูุจุณูุท:**
- ูุงุฌูุฉ ูุงุญุฏุฉ ูููุณุชุฎุฏู
- ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ
- ููุฏ ุฃูู ูุฃูุถุญ
- ุตูุงูุฉ ุฃุณูู

---

ุชุงุฑูุฎ ุงูุงูุชูุงู: 28 ุฃูุชูุจุฑ 2025
