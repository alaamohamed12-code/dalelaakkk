# نظام التقييمات (Rating & Review System)

تم إضافة نظام تقييم شامل للشركات يسمح للمستخدمين الأفراد بتقييم الشركات بعد التعاقد معهم.

## ✨ المميزات الرئيسية

### 1. تقييم الشركات
- ⭐ تقييم من 1 إلى 5 نجوم
- 💬 إضافة تعليق مع التقييم
- 🔒 تقييم واحد فقط لكل مستخدم لكل شركة
- 👤 عرض اسم المستخدم مع التقييم

### 2. عرض التقييمات
- 📊 حساب المتوسط الإجمالي للتقييمات
- 📈 توزيع التقييمات حسب عدد النجوم (5 نجوم، 4 نجوم، إلخ)
- 📋 عرض جميع التقييمات بشكل مرتب حسب التاريخ
- 🎨 تصميم احترافي مع تدرجات لونية جميلة

### 3. صفحة الشركة
- 🔖 تاب جديد "التقييمات" في صفحة الشركة
- 📊 ملخص شامل للتقييمات في الأعلى
- ✍️ نموذج إضافة تقييم (للمستخدمين الأفراد فقط)
- 👁️ عرض التقييم الخاص بالمستخدم إن وجد
- 📜 قائمة بجميع التقييمات

### 4. لوحة إدارة الأدمن
- 🔍 عرض جميع التقييمات في الموقع
- 🔢 فلترة حسب التقييمات الإيجابية (4-5) أو السلبية (1-2)
- 🗑️ إمكانية حذف التقييمات غير المناسبة
- 📊 عرض معلومات الشركة والمستخدم مع كل تقييم

## 🗄️ قاعدة البيانات

### جدول `company_reviews`
```sql
CREATE TABLE company_reviews (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  companyId INTEGER NOT NULL,
  userId INTEGER NOT NULL,
  userFirstName TEXT,
  userLastName TEXT,
  rating INTEGER NOT NULL CHECK(rating >= 1 AND rating <= 5),
  comment TEXT,
  createdAt TEXT DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (companyId) REFERENCES companies(id) ON DELETE CASCADE,
  UNIQUE(companyId, userId)
)
```

### إضافات لجدول `companies`
- `rating REAL DEFAULT 0` - المتوسط الإجمالي للتقييمات
- `reviewCount INTEGER DEFAULT 0` - عدد التقييمات

## 🔌 API Endpoints

### `/api/reviews`

#### GET - جلب تقييمات شركة
```typescript
GET /api/reviews?companyId=123

Response:
{
  reviews: [...],
  stats: {
    avgRating: 4.7,
    totalReviews: 10,
    distribution: {
      5: 7,
      4: 2,
      3: 1,
      2: 0,
      1: 0
    }
  }
}
```

#### POST - إضافة تقييم جديد
```typescript
POST /api/reviews
Body: {
  companyId: 123,
  userId: 456,
  userFirstName: "أحمد",
  userLastName: "محمد",
  rating: 5,
  comment: "خدمة ممتازة!"
}

Response:
{
  success: true,
  message: "تم إضافة التقييم بنجاح",
  reviewId: 789
}
```

#### DELETE - حذف تقييم
```typescript
DELETE /api/reviews?id=789&userId=456

Response:
{
  success: true,
  message: "تم حذف التقييم بنجاح"
}
```

### `/api/admin/reviews`

#### GET - جلب جميع التقييمات (للأدمن)
```typescript
GET /api/admin/reviews

Response:
{
  reviews: [
    {
      id: 1,
      companyId: 123,
      companyName: "شركة ABC",
      companyEmail: "company@example.com",
      companyImage: "image.jpg",
      userId: 456,
      userFirstName: "أحمد",
      userLastName: "محمد",
      rating: 5,
      comment: "خدمة ممتازة!",
      createdAt: "2024-01-15T10:30:00"
    },
    ...
  ]
}
```

#### DELETE - حذف تقييم (للأدمن)
```typescript
DELETE /api/admin/reviews?id=789

Response:
{
  success: true,
  message: "تم حذف التقييم بنجاح"
}
```

## 📁 الملفات المضافة/المعدلة

### ملفات جديدة:
1. `scripts/create-reviews-table.js` - سكريبت إنشاء جدول التقييمات
2. `app/api/reviews/route.ts` - API endpoints لإدارة التقييمات
3. `app/api/admin/reviews/route.ts` - API endpoints للأدمن
4. `app/admin-panel/reviews/page.tsx` - صفحة إدارة التقييمات

### ملفات معدلة:
1. `app/company/[id]/page.tsx` - إضافة تاب التقييمات
2. `app/admin-panel/dashboard/page.tsx` - إضافة زر إدارة التقييمات

## 🚀 كيفية الاستخدام

### للمستخدمين الأفراد:
1. زيارة صفحة أي شركة
2. الانتقال إلى تاب "التقييمات"
3. اختيار عدد النجوم (1-5)
4. كتابة تعليق
5. الضغط على "إضافة التقييم"

### للأدمن:
1. تسجيل الدخول إلى لوحة التحكم
2. الضغط على "إدارة التقييمات"
3. عرض جميع التقييمات
4. فلترة حسب الإيجابية/السلبية
5. حذف التقييمات غير المناسبة

## ⚠️ القيود والضوابط

1. ✅ المستخدمون الأفراد فقط يمكنهم إضافة تقييمات
2. ✅ تقييم واحد فقط لكل مستخدم لكل شركة
3. ✅ التقييم من 1 إلى 5 نجوم فقط
4. ✅ التعليق إلزامي
5. ✅ لا يمكن تعديل التقييم بعد الإضافة (يجب الحذف وإعادة الإضافة)

## 🎨 التصميم

- استخدام Tailwind CSS مع تدرجات لونية حديثة
- تصميم responsive يعمل على جميع الشاشات
- أنيميشن سلس عند التفاعل
- أيقونات نجوم بتصميم احترافي
- ألوان مميزة لكل فئة تقييم

## 📊 الإحصائيات

- عرض المتوسط العام للتقييمات
- عرض عدد التقييمات الكلي
- توزيع التقييمات في رسم بياني شريطي
- نسبة كل فئة من التقييمات

## 🔮 تحسينات مستقبلية محتملة

- [ ] إضافة إمكانية تعديل التقييم
- [ ] إضافة صور مع التقييمات
- [ ] نظام الرد على التقييمات من الشركات
- [ ] تقييمات مفيدة (Helpful/Not Helpful)
- [ ] فلترة وترتيب التقييمات (الأحدث، الأعلى تقييماً، إلخ)
- [ ] إشعارات للشركات عند إضافة تقييم جديد
- [ ] تقارير شهرية للشركات عن تقييماتها

## ✅ الاختبار

تم اختبار النظام ويتضمن:
- ✅ إضافة تقييمات تجريبية
- ✅ حساب المتوسط بشكل صحيح
- ✅ منع التقييمات المكررة
- ✅ حذف التقييمات
- ✅ تحديث تقييم الشركة تلقائياً
- ✅ عرض التقييمات بشكل صحيح

## 📝 ملاحظات

- النظام جاهز للاستخدام الفوري
- جميع الأخطاء البرمجية تم حلها
- التصميم متوافق مع باقي الموقع
- النظام آمن ضد التلاعب
