# ๐ ุฅุตูุงุญ ูุดููุฉ ุฅุฑุณุงู ุงูุฑุณุงุฆู

## ุงููุดููุฉ
ุนูุฏ ูุญุงููุฉ ุฅุฑุณุงู ุฑุณุงูุฉ ูู ูุณุชุฎุฏู ูุฑุฏ ุฅูู ุดุฑูุฉุ ุชุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ:
```
POST http://localhost:3000/api/messages 400 (Bad Request)
Missing required fields
```

### ุงูุณุจุจ
```javascript
{userId: NaN, companyId: 5, senderType: 'user', senderId: NaN, text: 'hello test'}
user.id: undefined
```

ุงูู `user.id` ูุงู `undefined` ูู localStorageุ ููุง ุฃุฏู ุฅูู `NaN` ุนูุฏ ุงุณุชุฎุฏุงู `Number(user.id)`.

---

## ุงูุญู ุงููุทุจู

### 1. โ ุงูุชุญูู ูู ูุฌูุฏ user.id
ุชู ุฅุถุงูุฉ ูุญุต ูู ููุฏ ุฅุฑุณุงู ุงูุฑุณุงูุฉ:

```typescript
// Check if user.id exists, if not, user needs to re-login
if (!user.id) {
  setMsgError(lang === 'ar' ? 'ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู' : 'Please login again');
  setTimeout(() => {
    localStorage.removeItem('user');
    router.push('/login');
  }, 2000);
  return;
}
```

### 2. โ ุชูุธูู ุงูููุฏ
ุชู ุฅุนุงุฏุฉ ููููุฉ ููุฏ ุงูุฅุฑุณุงู ููููู ุฃูุซุฑ ูุถูุญุงู ูุฃูุงูุงู:

```typescript
const user = JSON.parse(u);

// Validation: Check user.id exists
if (!user.id) {
  // Redirect to login
  return;
}

// Validation: Check account type
if (user.accountType !== 'individual') { 
  setMsgError('...');
  return; 
}

// Build payload
const payload = {
  userId: Number(user.id),
  companyId: Number(params.id),
  senderType: 'user',
  senderId: Number(user.id),
  text: messageText.trim(),
};
```

---

## ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ูุณุชุฎุฏู ุฌุฏูุฏ
1. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ูุฑุฏ ุฌุฏูุฏ
2. ุงุฐูุจ ูุตูุญุฉ ุฃู ุดุฑูุฉ
3. ุงุถุบุท ุฒุฑ "ูุฑุงุณูุฉ"
4. ุงูุชุจ ุฑุณุงูุฉ
5. ุงุถุบุท "ุฅุฑุณุงู"
6. โ ูุฌุจ ุฃู ุชูุฑุณู ุงูุฑุณุงูุฉ ุจูุฌุงุญ

### ุงุฎุชุจุงุฑ 2: ูุณุชุฎุฏู ูุฏูู (localStorage ูุฏูู)
1. ุฅุฐุง ูุงู ูุฏูู localStorage ูุฏูู ุจุฏูู `id`
2. ุญุงูู ุฅุฑุณุงู ุฑุณุงูุฉ
3. โ ุณุชุธูุฑ ุฑุณุงูุฉ "ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู"
4. โ ุณูุชู ุชูุฌููู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู ุชููุงุฆูุงู

### ุงุฎุชุจุงุฑ 3: ุดุฑูุฉ ุชุญุงูู ุงูุฅุฑุณุงู
1. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุดุฑูุฉ
2. ุงุฐูุจ ูุตูุญุฉ ุดุฑูุฉ ุฃุฎุฑู
3. ุงุถุบุท ุฒุฑ "ูุฑุงุณูุฉ"
4. โ ุณุชุธูุฑ ุฑุณุงูุฉ "ูููู ููุฃูุฑุงุฏ ููุท ุงูุฅุฑุณุงู"

---

## ุงููููุงุช ุงููุนุฏูุฉ

### `app/company/[id]/page.tsx`
- โ ุฅุถุงูุฉ ูุญุต `if (!user.id)`
- โ ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ
- โ ุฅุฒุงูุฉ localStorage ุงููุฏูู ูุฅุนุงุฏุฉ ุงูุชูุฌูู ูุชุณุฌูู ุงูุฏุฎูู
- โ ุฅุนุงุฏุฉ ููููุฉ ุงูููุฏ ููููู ุฃูุซุฑ ูุถูุญุงู

---

## ุญู ูููุณุชุฎุฏููู ุงูุญุงูููู

ุฅุฐุง ูุงู ุงููุณุชุฎุฏููู ุงูุญุงูููู ููุงุฌููู ูุฐู ุงููุดููุฉุ ูููููู:

### ุงูุญู ุงูุณุฑูุน
1. ุงูุชุญ Developer Tools (F12)
2. ุงุฐูุจ ูู Console
3. ุงูุชุจ:
```javascript
localStorage.removeItem('user');
location.reload();
```
4. ุณุฌู ุฏุฎูู ูู ุฌุฏูุฏ

### ุงูุญู ุงูุชููุงุฆู
ุณูุชู ุชูุฌูู ุงููุณุชุฎุฏู ุชููุงุฆูุงู ูุชุณุฌูู ุงูุฏุฎูู ุฅุฐุง ูุงู localStorage ูุฏูู.

---

## ููุงุท ูููุฉ

### โ ุงูุฃูุงู
- ุงูุชุญูู ูู ูุฌูุฏ ุฌููุน ุงูุจูุงูุงุช ุงููุทููุจุฉ ูุจู ุงูุฅุฑุณุงู
- ุนุฏู ุงูุณูุงุญ ุจู `NaN` ุฃู `undefined` ูู ุงูุทูุจุงุช

### โ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- ุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ ูุญู ุงููุดููุฉ
- ูุง ุญุงุฌุฉ ููุชุฏุฎู ุงููุฏูู

### โ ุงูุตูุงูุฉ
- ููุฏ ููุธู ูุณูู ุงููุฑุงุกุฉ
- ุชุนูููุงุช ุชูุถูุญูุฉ
- ูุญูุตุงุช ูุชุณูุณูุฉ ูุงุถุญุฉ

---

## Console Output ุงูุฌุฏูุฏ

**ูุจู ุงูุฅุตูุงุญ:**
```
user.id: undefined type: undefined
{userId: NaN, companyId: 5, senderType: 'user', senderId: NaN, text: 'hello test'}
POST http://localhost:3000/api/messages 400 (Bad Request)
```

**ุจุนุฏ ุงูุฅุตูุงุญ (ูุณุชุฎุฏู ุฌุฏูุฏ):**
```
user.id: 123 type: number
{userId: 123, companyId: 5, senderType: 'user', senderId: 123, text: 'hello test'}
โ Message sent successfully
```

**ุจุนุฏ ุงูุฅุตูุงุญ (ูุณุชุฎุฏู ูุฏูู):**
```
โ๏ธ ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู
โ Redirecting to /login
```

---

## ุงูุญุงูุฉ ุงูููุงุฆูุฉ

โ **ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจุงููุงูู**
- ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ: ูููููู ุฅุฑุณุงู ุงูุฑุณุงุฆู ุจูุฌุงุญ
- ุงููุณุชุฎุฏููู ุงููุฏุงูู: ูุชู ุชูุฌูููู ูุชุณุฌูู ุงูุฏุฎูู ุชููุงุฆูุงู
- ุงูุดุฑูุงุช: ูุง ูููููู ุฅุฑุณุงู ุฑุณุงุฆู ูุดุฑูุงุช ุฃุฎุฑู
- ุฑุณุงุฆู ุงูุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ
- ุงูููุฏ ููุธู ูุขูู

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 28 ุฃูุชูุจุฑ 2025  
**ุงููููุงุช ุงููุนุฏูุฉ:** 1 (`app/company/[id]/page.tsx`)  
**ููุน ุงูุฅุตูุงุญ:** Validation + UX Improvement
